<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Tour del Cavallo - Algoritmo</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 20px;
    }
    canvas {
      border: 2px solid black;
      margin-top: 10px;
    }
    .controls {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    button {
      width: 70px;
      height: 70px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      touch-action: manipulation;
      user-select: none;
      font-size: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #nextBtn {
      background-color: #007bff;
      color: white;
    }
    #nextBtn:hover {
      background-color: #0056b3;
    }
    #resetBtn {
      background-color: #ffc107;
      padding: 0;
      overflow: hidden;
    }
    #resetBtn img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
  </style>
</head>
<body>
  <h2>Tour del Cavallo ♞ - Calcolo con algoritmo</h2>
  <canvas id="board" width="360" height="360"></canvas><br />
  <div class="controls">
    <button id="nextBtn">▶</button>
    <button id="resetBtn"><img src="reset.png" alt="Reset"></button>
  </div>

  <script>
    const canvas = document.getElementById("board");
    const ctx = canvas.getContext("2d");
    const size = 8;
    const cell = canvas.width / size;
    let tour = [], step = 0;

    function valid(x, y) {
      return x >= 0 && y >= 0 && x < size && y < size;
    }
    function knightMoves(x, y) {
      return [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]
        .map(([dx,dy]) => [x+dx, y+dy])
        .filter(([nx,ny]) => valid(nx, ny));
    }
    function warnsdorffTour(sx, sy) {
      const board = Array.from({ length: size }, () => Array(size).fill(-1));
      board[sy][sx] = 0;
      const path = [[sx, sy]];
      for (let s = 1; s < size * size; s++) {
        const [x,y] = path[path.length-1];
        const cands = knightMoves(x,y)
          .filter(([cx,cy]) => board[cy][cx] === -1)
          .map(([cx,cy]) => ({ pos:[cx,cy],
            count:knightMoves(cx,cy).filter(([nx,ny])=>board[ny][nx]===-1).length }))
          .sort((a,b)=>a.count-b.count);
        if (!cands.length) return null;
        const [nx,ny] = cands[0].pos;
        board[ny][nx] = s;
        path.push([nx,ny]);
      }
      return path;
    }
    function drawBoard() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.font = "bold 14px sans-serif"; ctx.textBaseline="top";
      for (let y=0;y<size;y++)
        for (let x=0;x<size;x++)
          ctx.fillStyle = (x+y)%2===0 ? "#ffffff" : "#000000",
          ctx.fillRect(x*cell, y*cell, cell, cell);
      for (let i=0;i<step;i++) {
        const [x,y] = tour[i];
        ctx.fillStyle = "rgba(0,255,0,0.4)";
        ctx.fillRect(x*cell,y*cell,cell,cell);
        ctx.fillStyle = "black";
        ctx.fillText(i+1, x*cell+4, y*cell+4);
      }
    }
    function drawKnight(x,y){
      ctx.fillStyle="blue";
      ctx.beginPath();
      ctx.arc(x*cell+cell/2, y*cell+cell/2, cell/3,0,2*Math.PI);
      ctx.fill();
    }
    function nextMove(){
      if (step>=tour.length){alert("Tour completato!");return;}
      drawBoard();
      const [x,y]=tour[step++];
      drawKnight(x,y);
    }
    function resetTour(){
      tour = warnsdorffTour(0,0);
      step = 0;
      if (!tour){alert("Impossibile generare il tour");return;}
      drawBoard();
    }

    document.getElementById("nextBtn").addEventListener("click", nextMove);
    document.getElementById("resetBtn").addEventListener("click", resetTour);
    window.onload = resetTour;
  </script>
</body>
</html>
